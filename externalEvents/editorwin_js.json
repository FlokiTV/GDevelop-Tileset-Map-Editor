{
  "associatedLayout": "New scene",
  "lastChangeTimeStamp": 0,
  "name": "EditorWin_JS",
  "events": [
    {
      "disabled": false,
      "folded": false,
      "type": "BuiltinCommonInstructions::JsCode",
      "inlineCode": "const DOM   = gdjs._json2html\nconst $DOM  = gdjs._DOMapi\nconst $WIN  = gdjs._windowManager\nconst $TILE = gdjs._TileSetMapEditor\nwindow._winManager.editor = {\n    title: 'tileset editor',\n    id: 'tileset_editor',\n    pos:{\n        left: \"50%\",\n        top: \"50%\",\n    },\n    size:{\n        maxwidth: \"400px\",\n    },\n    content:[\n        DOM.newEl(\"style\",{\n            html:`\n                .tileset_editor div{\n                    width: 31px;\n                    height: 31px;\n                    outline: 1px solid rgba(255,0,0,0.1);\n                    float:left;\n                    position: relative;\n                    margin-top:1px;\n                    margin-left:1px;\n                }\n                .tileset_editor div.active,\n                .tileset_editor div:hover{\n                    outline: 1px solid rgba(255,0,0,1);\n                }\n                .tileset_editor div.active:after,\n                .tileset_editor div:hover:after{\n                    opacity: 1\n                }\n                .tileset_editor div:after {\n                    opacity: 0;\n                    content: attr(data-pos);\n                    background: rgba(255,0,0,1);\n                    color: #fff;\n                    font-size: 10px;\n                    left: 0;\n                    top: 0;\n                    position: absolute;\n                    padding: 1px 2px;\n                }\n                .preview-tile-editor-tools{\n\n                }\n                .preview-tile-editor-tools svg{\n                    width:14px!important;\n                    height:14px!important;\n                }\n            `\n        }),\n        DOM.newEl('div',{\n            ref:'preview-tile-editor-container',\n            class:'is-flex',\n            html:[\n                DOM.newEl('div',{\n                    ref:'preview-tile-editor-tools',\n                    class:'preview-tile-editor-tools',\n                    style:'width:50%',\n                    html:[\n//buttons\n                        DOM.newEl('div',{\n                            class:'buttons is-fullwidth',\n                            html:[\n                                BULMA.button({\n                                    html: gdjs._TileSetMapEditorIcons.edit.svg\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    ref: 'clear',\n                                    html: gdjs._TileSetMapEditorIcons.eraser.svg\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    html: gdjs._TileSetMapEditorIcons.stamper.svg\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    html: gdjs._TileSetMapEditorIcons.grid.svg,\n                                    onready: function(){\n                                        $DOM.once($(this), EL =>{\n                                            $(EL).hover(function(){\n                                                $DOM.selectElbyRef('help-text').text('toggle grid')\n                                            })\n                                            $(EL).click(function(){\n                                                $(EL).toggleClass('is-black')\n                                                if($(EL).hasClass('is-black')){\n                                                    // set grid off\n                                                    $(EL).html(gdjs._TileSetMapEditorIcons.gridOff.svg)\n                                                    runtimeScene.getLayer(\"Grid\").show(false)\n                                                }else{\n                                                    $(EL).html(gdjs._TileSetMapEditorIcons.grid.svg)\n                                                    runtimeScene.getLayer(\"Grid\").show(true)\n                                                }\n                                            })\n                                        })\n                                    }\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    ref:\"center-camera\",\n                                    html: gdjs._TileSetMapEditorIcons.cameraControl.svg,\n                                    onready: function(){\n                                        $DOM.once($(this), function(EL){\n                                            DOM.setupListeners(EL)\n                                            $(EL).hover(function(){\n                                                $DOM.selectElbyRef('help-text').text('center camera')\n                                            })\n                                        })\n                                    }\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    html: gdjs._TileSetMapEditorIcons.rect.svg,\n                                    onready: function(){\n                                        $DOM.once($(this), function(EL){\n                                            $(EL).hover(function(){\n                                                $DOM.selectElbyRef('help-text').text('toggle window mask')\n                                            })\n                                            $(EL).click(function(){\n                                                \n                                                $(this).toggleClass('is-dark')\n                                                $(this).toggleClass('is-black')\n                                                runtimeScene.getGame().getVariables().get('draw_window').setBoolean($(this).hasClass('is-black'))\n                                            })\n                                        })\n                                    }\n                                }, 'is-small is-dark'),\n                                BULMA.button({\n                                    html: gdjs._TileSetMapEditorIcons.contentSave.svg,\n                                    onready: function(){\n                                        $DOM.once($(this), function(EL){\n                                            $(EL).hover(function(){\n                                                $DOM.selectElbyRef('help-text').text('save GDevelop project as zip')\n                                            })\n                                            $(EL).click(function(){\n                                                $TILE.generate()\n                                            })\n                                        })\n                                    }\n                                }, 'is-small is-dark'),\n                            ]\n                        }),\n//Select layer\n                        BULMA.form.field({\n                            html:[\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            text:'Top',\n                                            ref: 'btn-layer',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('select top layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT  = 2\n                                                        $TILE.setLayer(SELECT)\n                                                        $DOM.selectElbyRef('btn-layer').removeClass('is-black').addClass('is-dark')\n                                                        $(this).removeClass('is-dark').addClass('is-black')\n                                                        // let BTN     = $DOM.selectElbyRef('select-layer-eye-top')\n                                                        // if(runtimeScene.getLayer(\"Layer\"+SELECT).isVisible()){\n                                                        //     $(BTN).html(gdjs._TileSetMapEditorIcons.eye.svg)\n                                                        // }else\n                                                        //     $(BTN).html(gdjs._TileSetMapEditorIcons.eyeOff.svg)\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-dark is-fullwidth')\n                                    ]\n                                }, 'is-expanded'),\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            html: gdjs._TileSetMapEditorIcons.eye.svg,\n                                            ref: 'select-layer-eye-top',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('toggle visibility of top layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT = 2\n                                                        // runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        if(runtimeScene.getLayer(\"Layer\"+SELECT).isVisible()){\n                                                            // set layer off\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eyeOff.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        }else{\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eye.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(true)\n                                                        }\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-dark')\n                                    ]\n                                })\n                            ]\n                        }, 'has-addons'),\n                        //center\n                        BULMA.form.field({\n                            html:[\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            text:'Center',\n                                            ref: 'btn-layer',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('select center layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT  = 1\n                                                        $TILE.setLayer(SELECT)\n                                                        $DOM.selectElbyRef('btn-layer').removeClass('is-black').addClass('is-dark')\n                                                        $(this).removeClass('is-dark').addClass('is-black')\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-black is-fullwidth')\n                                    ]\n                                }, 'is-expanded'),\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            html: gdjs._TileSetMapEditorIcons.eye.svg,\n                                            ref: 'select-layer-eye-center',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('toggle visibility of center layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT = 1\n                                                        // runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        if(runtimeScene.getLayer(\"Layer\"+SELECT).isVisible()){\n                                                            // set layer off\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eyeOff.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        }else{\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eye.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(true)\n                                                        }\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-dark')\n                                    ]\n                                })\n                            ]\n                        }, 'has-addons'),\n                        // bottom\n                        BULMA.form.field({\n                            html:[\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            text:'Bottom',\n                                            ref: 'btn-layer',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('select bottom layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT  = 0\n                                                        $TILE.setLayer(SELECT)\n                                                        $DOM.selectElbyRef('btn-layer').removeClass('is-black').addClass('is-dark')\n                                                        $(this).removeClass('is-dark').addClass('is-black')\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-dark is-fullwidth')\n                                    ]\n                                }, 'is-expanded'),\n                                BULMA.form.control({\n                                    html:[\n                                        BULMA.button({ \n                                            html: gdjs._TileSetMapEditorIcons.eye.svg,\n                                            ref: 'select-layer-eye-bottom',\n                                            onready: function(){\n                                                $DOM.once($(this), EL =>{\n                                                    $(this).hover(function(){\n                                                        $DOM.selectElbyRef('help-text').text('toggle visibility of bottom layer')\n                                                    })\n                                                    $(EL).click(function(){\n                                                        let SELECT = 0\n                                                        // runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        if(runtimeScene.getLayer(\"Layer\"+SELECT).isVisible()){\n                                                            // set layer off\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eyeOff.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(false)\n                                                        }else{\n                                                            $(EL).html(gdjs._TileSetMapEditorIcons.eye.svg)\n                                                            runtimeScene.getLayer(\"Layer\"+SELECT).show(true)\n                                                        }\n                                                    })\n                                                })\n                                            }\n                                        }, 'is-small is-dark')\n                                    ]\n                                })\n                            ]\n                        }, 'has-addons'),\n                        //Help text\n                        DOM.newEl(\"p\", { ref:\"help-text\" ,style:'height: 20px;', text: 'some text', class:'has-text-white' })\n                    ]\n                }),\n                DOM.newEl('div',{\n                    ref:'preview-tile-editor-image',\n                    style:'width:50%',\n                    html:[\n                        DOM.newEl('img',{\n                            ref:'preview-tile-editor'\n                        }),\n                        BULMA.form.field({\n                            html:[\n                                BULMA.form.control({ ref:'preview-tile-size', html: [\n                                    DOM.newEl(\"input\", { type: 'range', step:1, min:1, max:5, value: 1,\n                                    style:'width:100%',\n                                    onchange: function(){\n                                        const image = $($DOM.selectElbyRef('preview-tile-editor'))\n                                        const size  = parseInt(image.attr('data-size'))\n                                        image.attr('style',`width:${size*$(this).val()}px; image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges;`)\n                                    }})\n                                ] })\n                            ]\n                        }),\n                    ]\n                })\n            ]\n        }),\n        BULMA.form.field({\n            html:[\n                BULMA.form.control({\n                    html:[\n                        DOM.newEl(\"div\", {\n                            class:'select is-fullwidth is-small',\n                            html:[ DOM.newEl(\"select\", {\n                                ref: \"tileset-select\",\n                                onready:function(){\n                                    const loadTileLib = () =>{\n                                        $(this).attr('data-init', true)\n                                        $TILE._resources.forEach( res => $(this).json2html({}, DOM.newEl(\"option\", { text: res.name })) )\n                                    }\n                                    if(!$(this).attr('data-init'))\n                                        loadTileLib()\n                                }\n                            }) ]\n                        })\n                    ]\n                }, 'is-expanded'),\n                BULMA.form.control({\n                    html:[ BULMA.button({\n                        text: 'load',\n                        onready: function(){\n                            $(this).hover(function(){\n                                $DOM.selectElbyRef('help-text').text('load tileset map')\n                            })\n                            $(this).click(function(){\n                                const SELECT    = $DOM.selectElbyRef('tileset-select')\n                                const PREVIEW   = $DOM.selectElbyRef('tileset-select-preview')\n                                const INSTANCE  = SELECT.val()\n                                const TILES     = $TILE.getResource(INSTANCE)\n                                PREVIEW.html(\"\")\n                                // set width\n                                PREVIEW.width(TILES.size.x * TILES.size.width + \"px\")\n                                TILES.animations.forEach(tile =>{\n                                    $(PREVIEW)\n                                        .json2html({},\n                                            DOM.newEl(\"div\", {\n                                                ref: tile.name,\n                                                'data-pos': tile.name.replace(\"_\",\":\"),\n                                                'data-instance': INSTANCE,\n                                                'data-animation': tile.name,\n                                                'data-size': 32,\n                                                style: `background-image: url('${tile.data}')`,\n                                                onready: function(){\n                                                    $(this).click(function(){\n                                                        // set editor instance\n                                                        const ANIMATION = $(this).attr('data-animation')\n                                                        $TILE.setInstance(INSTANCE, ANIMATION)\n                                                        \n                                                        $(this).parent().find(\".active\").removeClass(\"active\")\n                                                        $(this).addClass(\"active\")\n                                                        let image = $($DOM.selectElbyRef('preview-tile-editor'))\n                                                        let src = $(this).css(\"background-image\")\n                                                        src = src.replace('url(\"',\"\")\n                                                        src = src.replace('\")',\"\")\n                                                        image.attr('data-size', $(this).attr('data-size'))\n                                                        image.attr('src', src)\n                                                        // load texture\n                                                        let res = $TILE.getResourceTexture(INSTANCE, ANIMATION)\n                                                        if(!res) {\n                                                            let img = new Image()\n                                                            img.addEventListener('load', ()=>{\n                                                                gdjs._TileSetMapEditor.loadResouceTexture(INSTANCE, ANIMATION, img)\n                                                            })\n                                                            img.src = src\n                                                        }\n                                                        // console.log(res)\n                                                    })\n                                                }\n                                            })\n                                        )\n                                })\n                            })\n                        }\n                    }, 'is-small is-black')]\n                })\n            ]\n        }, 'has-addons'),\n        DOM.newEl(\"div\",{\n            style:` overflow: auto; max-height: 330px`,\n            html:[\n                DOM.newEl(\"div\",{\n                    ref: 'tileset-select-preview',\n                    class: 'tileset_editor',\n                    style:`\n                        display: flex;\n                        flex-wrap: wrap;\n                    `,\n                })\n            ]\n        })\n    ],\n    onready: function(win){\n        const EL = win.el\n        $DOM.once(EL, ()=>{\n            $(EL).find('header').dblclick(function(){\n                $(EL).find('.window-content').slideToggle()\n            })\n            $(EL).css('min-height','auto')\n            // $(EL).find('header span').width(\"100%\")\n            // $(EL).find('header .btns').css('display', 'none')\n        })\n    }\n}",
      "parameterObjects": "",
      "useStrict": true,
      "eventsSheetExpanded": true
    }
  ]
}